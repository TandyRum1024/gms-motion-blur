<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <link href="https://fonts.googleapis.com/css?family=Black+Han+Sans|Bree+Serif|Nanum+Gothic+Coding:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="main.css">
    <script type="text/javascript" src="webstuffs.js"></script>

    <!-- highlight.js -->
    <link rel="stylesheet" href="assets/styles/gruvbox-dark.css">
    <script type="text/javascript" src="assets/highlight.pack.js"></script>
    <script type="text/javascript">hljs.initHighlightingOnLoad();</script>
    <title>Things about: My motion blur tech demo for Gamemaker</title>
</head>
<body onload="page_init()">
    <!-- Navzone[tm] -->
    <div id="aside-wrapper">
        <aside>
            <div id="top-bar">
                <b>GOTO:</b><button onclick="toggle_bar()">//</button>
            </div>
            <ul>
            </ul>
        </aside>
    </div>

    <!-- Contentszone[tm] -->
    <div id="article-wrapper">
        <!-- Header -->
        <div id="header-wrapper">
            <div id="header-content-wrapper">
                <!-- <header>햄버거를 숨기는 여러 방법</header> -->
                <!-- <header>Normal yet ordinary Title</header> -->
                <!-- <p>TODO : Write something here</p> -->
                <header>Begging my GPU for a fancy Motion-blur effect:</header>
                <p>A write-up & ramblings about my recent tech demo</p>
            </div>
        </div>

        <!-- Table of contents -->
        <div id="toc-wrapper">
            <div>
                <p>ToC</p>
                <ul>
                </ul>
            </div>
        </div>

        
        <!-- Contents -->
        <article>
            <!-- alert -->
            <div class="alert checker-bg">
                <div id="left" class="drop-shadow-4px">
                    <div id="image"></div>
                </div>
                <div id="right">
                    <!-- <h1 class="title">Warning : This is warning.</h1> -->
                    <!-- <h1 class="title">오우, 한국어 좀 읽을 줄 아는 녀석인가?</h1>
                    <p>한국어가 편하신 분들을 위해, 한국어로 쓰인 문서도 준비되어있습니다 : <a href="https://fonts.google.com">[한국어 문서 / Korean document]</a></p> -->
                    <!-- <p>If you see this, <i>ETAOIN SHRDLU</i>.</p> -->
                    <h1 class="title">What the h*ck, He is small and pointing.</h1>
                    <p><i>He is pointing.</i></p>
                </div>
            </div>
            
            <!-- real stuffs begins here -->
            <h1 id="introduction">Introduction</h1><hr>
            <article class="image-center">
                <div id="image-list">
                    <img src="pics/SHOWCASE_2D_2.png">
                    <img src="pics/SHOWCASE_3D.png">
                </div>
                <p>images of my motion blur doing motion blur-y stuff.</p>
            </article>
            <p>
            Back in 2017 when I had a <i>LOT</i> of free time after the midterm exam has ended, I was writing up some platformer engine for fun. After implementing the basic camera system and seeing it bounce around hillariously due to an error in the integrating method, I was struck with an idea about implementing a motion blur shader.<br>After fiddling around with GLSL Shading language, I managed to write up some decent camera based motion blur. And then I took it a step further, And implemented noised based dithering to make the result more smooth with better performance... But then I somehow stopped working on it. I'm not sure if its the dried-out enthusiasm or slump doing its job, It was shelved for god knows how long.. And it got removed when I (foolishly) wiped my hard drive with my old yet brilliant projects in it.<br>2 Years later, I've been lately experimenting with visual effects <i>(particularly blurring & procedural animations)</i> a lot.. And I remembered about the project with fancy motion blur tech being wiped & gone for good, I decided to <i>"revive"</i> the project by doing a complete rewrite.<br>
            The rewrite went pretty well, And using the recently gained knowledge of shaders, I actually improved upon it too.<br>
            And now since I don't wanna repeat the same foolish mistake again, I decided to make it open-sourced on internet & write some documents about it. Enjoy!
            </p>

            <h1 id="motionblur">Motion blur and motion offsets</h1><hr>
            <p>
                <img src="pics/EX_BLUR.png" class="image-center">
                Motion blur in theory is about fast moving object's afterimage.. And for camera based motion blur, We can (cheap and easily) simulate it by applying blurs in various direction according to camera's velocity.<br>To be more specific, We can apply directional blurs for x and y movements of camera, zoom blur for forward/zooming movements of camera and rotational blur for... well, rotating movements of camera.<br>
                <img src="pics/EX_COMPOSITE_BLUR.png" class="image-center">
                We could just apply directional blur for x/y velocity then apply zoom & angular blur for zoom and rotational velocity of the camera.
                But applying blur that way seems bit inefficient.. There's gotta be a better way!<br>Good news : We do have a better way for that. What we can do instead of aforementioned method is that we can combine the offset vectors calculated from camera's x, y and zoom velocity into one "offset vector" and use that alongside the rotational offset (that is calculated separately) when we're sampling the texture for the blur in shader. That way we can only use 1 blur pass for the motion blur!<br>
                <article class="image-center">
                    <img src="pics/EX_MOTION_OFFSETS.png" class="image-center">
                    <p>figure illustrating the method of more efficient blurring method.</p>
                </article>
            </p>
            <article class="image-center">
                <img src="pics/MOTION_BLUR_VISUALIZATION.png" style="width: 80%;">
                <p>image featuring offset vectors being visualized<br>(left : resulting blurred image, right : sum of motion "offsets" that is used for blurring)</p>
            </article>
            <p>
                The code below is the snippet of my motion blur shader that utilizes the principle above.
                <pre><code class="glsl">
// v_vTexcoord is the screenspace UV, ranging from [0..1].
// Calculate distance from center for zoom offset factor.
// we multiply it with distance from the center to avoid lens-like distortion
vec2 ctDelta = v_vTexcoord - vec2(0.5); // distance from center
vec2 ctNormalized = normalize(ctDelta); // normalized direction from center
float zoomStr = length(ctDelta) * uStrength.y * uVelocity.z;

// Calculate the offset vector from zoom & x/y velocity...
vec2 xyVel = uStrength.x * uVelocity.xy;
vec2 zoomVel = -ctNormalized * zoomStr;
vec2 linearOff = v_vPixelsize * xyVel + zoomVel;

// This is the loop that calculates the blur effect.
const float stepFactor = 1.0 / (SAMPLES_COUNT + 1.0); // factor to make the result into [0.0..1.0] range
const float stepSize = 1.0 / SAMPLES_COUNT;
for (float i = 0.0; i <= SAMPLES_COUNT; i += 1.0)
{
    // interpolate "linear" offset UV
    vec2 uvoff = linearOff * i * stepSize;
    
    // interpolate rotation angle and use it to get rotated uv
    // Note : Unlike the x/y and zoom offset `linearOff` can be interpolated via multiplying by some factor in [0..1] range,
    // Rotational offset cannot be interpolated by multiplying it by some factor.
    // So we have to "interpolate" the angle [rotAngle] in the loop for blur and use the resulting angle to get the rotational offset.
    float rotVel = -uVelocity.w * uStrength.z;
    float angle = rotVel * i;

    // rot2D() returns rotated UV from given UV and texture size and amount of rotation in degrees.
    vec2 uvrot = rot2D(v_vTexcoord, v_vTexsize, angle);
    
    // this is the final UV that we can sample the texture with!
    vec2 finalUV = uvrot + uvoff;

    // sample & accumulate blurred result into final buffer.
    // gm_BaseTexture is the texture of currently drawing VBO.. Basically we're sampling the screen texture.
    final += texture2D(gm_BaseTexture, finalUV) * stepFactor;
}
                </code></pre>
                You can see the full source & examples at the <a href="https://github.com/TandyRum1024/gms-motion-blur">GitHub repo</a>.<br>
                <br>
                Note #1 :<br>
                <code>vec2 v_vTexcoord</code> is the screenspace UV, ranging from [0..1].<br>
                <code>vec2 v_vTexsize</code> is the size of screen texture, Or the size of screen.<br>
                <code>sampler2D gm_BaseTexture</code> is the sampler / texture of Vertices, You can assume this as a screen texture.<br>
                <code>vec2 rot2D()</code> returns rotated UV from given UV and texture size and amount of rotation in degrees.<br>
                <br>
                Note #2 :<br>
                Notice that we're calculating the rotational offsets in the blurring loop... This is because unlike the x/y and zoom offsets (which can be "interpolated" via multiplying the offsets by some factor in [0..1] range), The rotational offset itself cannot be interpolated by multiplying the offset.<br>
                Instead, We need to interpolate the angle that we use to get the rotated UVs, And use the sum of rotated UVs and aforementioned x/y and zoom offsets to sample the textures!
            </p>

            <h1 id="dithering">The dithering</h1><hr>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. In elit diam, sollicitudin quis bibendum eu, consectetur quis neque. Donec faucibus nisi in nulla pharetra, dignissim fermentum justo maximus. Phasellus viverra, elit sed fermentum viverra, dui massa sodales quam, ac dignissim lorem ligula eget nulla. Aliquam at leo tellus. Aliquam sed dui at felis congue feugiat euismod sed nunc. Sed sit amet est ut risus bibendum dignissim. Fusce nibh lorem, lobortis ut lacus quis, sollicitudin placerat lacus. Nullam aliquam purus mauris, non finibus risus pretium tempor. Sed ipsum turpis, auctor at lacinia eu, lacinia et dui. Sed laoreet convallis condimentum. Donec vulputate ante in sagittis pharetra. Quisque id elit nibh. Ut ultrices et ex vel laoreet. Etiam eu bibendum ex. Suspendisse dictum pellentesque malesuada. Maecenas quis fermentum urna. Nam tincidunt nulla sit amet odio ultricies finibus consectetur sit amet velit. Phasellus accumsan eget magna sit amet suscipit. Etiam ac luctus justo. Vivamus ut sapien a velit tristique tempor nec quis turpis. Pellentesque porttitor, mauris a sagittis rutrum, ligula nunc euismod ex, ut imperdiet nulla erat ac neque. Pellentesque non risus quam. Vestibulum porta facilisis libero, ultricies pretium leo suscipit in. Nulla ac arcu metus. Cras metus nibh, dignissim vitae turpis eget, ornare feugiat magna. Pellentesque eu dui ut purus feugiat semper. Etiam vulputate mi non ante semper interdum. Sed eu mi ultrices ipsum molestie bibendum eu et nisi. Sed vitae nibh in ipsum tempor lacinia. Nam sit amet urna at dolor tristique bibendum. Nulla facilisi. Nullam diam sem, viverra vel ipsum et, iaculis dapibus arcu. Sed ut sapien in nunc aliquet maximus. Ut vitae turpis turpis. Mauris pellentesque egestas odio id consequat. Proin et nunc condimentum, faucibus est eu, interdum velit. Suspendisse sit amet gravida est. Phasellus vel augue non purus convallis facilisis. Morbi consequat enim risus, sit amet consequat ante suscipit eget. Vestibulum sed auctor sapien. Sed posuere venenatis felis ac porttitor. Nullam dictum ultrices purus sit amet tempus. In ac pretium lorem. Fusce vestibulum diam ac viverra hendrerit. Morbi facilisis mauris non mollis dignissim. Pellentesque ut odio fringilla, sagittis eros ac, aliquet arcu. Phasellus volutpat nisi id lectus porttitor, in tristique nulla fringilla. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Phasellus fringilla metus ac lorem ultricies eleifend at non urna. Vivamus ac porttitor nunc. Suspendisse pulvinar, arcu vitae vulputate dapibus, purus justo luctus metus, quis ultrices eros ligula viverra elit. Quisque id ornare nulla, non sollicitudin sem. Donec sem arcu, posuere eu efficitur eu, hendrerit nec urna. Morbi euismod molestie felis vel iaculis. Suspendisse feugiat urna consectetur, tristique lacus in, mattis erat. Pellentesque elit velit, consequat quis tincidunt ac, finibus in ante. Suspendisse blandit nisl mi, at tincidunt mi laoreet ac. Cras sit amet accumsan est. Curabitur sit amet ornare sem, fringilla pellentesque urna. Morbi ac bibendum quam. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque fermentum nec enim sit amet pharetra. Cras neque ante, laoreet nec venenatis non, mattis ac libero. Aliquam viverra vestibulum tempor. Aliquam porttitor diam eu volutpat rutrum. Nulla dictum nunc nec ullamcorper consectetur. Aliquam erat volutpat. Integer ac ultrices felis, in varius metus. In hac habitasse platea dictumst. Sed lacus tortor, luctus eu lobortis eu, sagittis non turpis. Mauris ac elit ut risus porta sagittis sed eget nisl. Pellentesque sodales est non congue euismod. In in odio lobortis, blandit lectus quis, venenatis ipsum. Cras sapien dolor, blandit ut posuere at, bibendum a ipsum. Sed quis massa in ex luctus lacinia. Vivamus nec eros nisi. Proin luctus augue et porttitor pellentesque. Vivamus tempor sollicitudin ante molestie placerat.</p>

            <h1 id="more-dithering">Hell yes, Even more dithering</h1><hr>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. In elit diam, sollicitudin quis bibendum eu, consectetur quis neque. Donec faucibus nisi in nulla pharetra, dignissim fermentum justo maximus. Phasellus viverra, elit sed fermentum viverra, dui massa sodales quam, ac dignissim lorem ligula eget nulla. Aliquam at leo tellus. Aliquam sed dui at felis congue feugiat euismod sed nunc. Sed sit amet est ut risus bibendum dignissim. Fusce nibh lorem, lobortis ut lacus quis, sollicitudin placerat lacus. Nullam aliquam purus mauris, non finibus risus pretium tempor. Sed ipsum turpis, auctor at lacinia eu, lacinia et dui. Sed laoreet convallis condimentum. Donec vulputate ante in sagittis pharetra. Quisque id elit nibh. Ut ultrices et ex vel laoreet. Etiam eu bibendum ex. Suspendisse dictum pellentesque malesuada. Maecenas quis fermentum urna. Nam tincidunt nulla sit amet odio ultricies finibus consectetur sit amet velit. Phasellus accumsan eget magna sit amet suscipit. Etiam ac luctus justo. Vivamus ut sapien a velit tristique tempor nec quis turpis. Pellentesque porttitor, mauris a sagittis rutrum, ligula nunc euismod ex, ut imperdiet nulla erat ac neque. Pellentesque non risus quam. Vestibulum porta facilisis libero, ultricies pretium leo suscipit in. Nulla ac arcu metus. Cras metus nibh, dignissim vitae turpis eget, ornare feugiat magna. Pellentesque eu dui ut purus feugiat semper. Etiam vulputate mi non ante semper interdum. Sed eu mi ultrices ipsum molestie bibendum eu et nisi. Sed vitae nibh in ipsum tempor lacinia. Nam sit amet urna at dolor tristique bibendum. Nulla facilisi. Nullam diam sem, viverra vel ipsum et, iaculis dapibus arcu. Sed ut sapien in nunc aliquet maximus. Ut vitae turpis turpis. Mauris pellentesque egestas odio id consequat. Proin et nunc condimentum, faucibus est eu, interdum velit. Suspendisse sit amet gravida est. Phasellus vel augue non purus convallis facilisis. Morbi consequat enim risus, sit amet consequat ante suscipit eget. Vestibulum sed auctor sapien. Sed posuere venenatis felis ac porttitor. Nullam dictum ultrices purus sit amet tempus. In ac pretium lorem. Fusce vestibulum diam ac viverra hendrerit. Morbi facilisis mauris non mollis dignissim. Pellentesque ut odio fringilla, sagittis eros ac, aliquet arcu. Phasellus volutpat nisi id lectus porttitor, in tristique nulla fringilla. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Phasellus fringilla metus ac lorem ultricies eleifend at non urna. Vivamus ac porttitor nunc. Suspendisse pulvinar, arcu vitae vulputate dapibus, purus justo luctus metus, quis ultrices eros ligula viverra elit. Quisque id ornare nulla, non sollicitudin sem. Donec sem arcu, posuere eu efficitur eu, hendrerit nec urna. Morbi euismod molestie felis vel iaculis. Suspendisse feugiat urna consectetur, tristique lacus in, mattis erat. Pellentesque elit velit, consequat quis tincidunt ac, finibus in ante. Suspendisse blandit nisl mi, at tincidunt mi laoreet ac. Cras sit amet accumsan est. Curabitur sit amet ornare sem, fringilla pellentesque urna. Morbi ac bibendum quam. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque fermentum nec enim sit amet pharetra. Cras neque ante, laoreet nec venenatis non, mattis ac libero. Aliquam viverra vestibulum tempor. Aliquam porttitor diam eu volutpat rutrum. Nulla dictum nunc nec ullamcorper consectetur. Aliquam erat volutpat. Integer ac ultrices felis, in varius metus. In hac habitasse platea dictumst. Sed lacus tortor, luctus eu lobortis eu, sagittis non turpis. Mauris ac elit ut risus porta sagittis sed eget nisl. Pellentesque sodales est non congue euismod. In in odio lobortis, blandit lectus quis, venenatis ipsum. Cras sapien dolor, blandit ut posuere at, bibendum a ipsum. Sed quis massa in ex luctus lacinia. Vivamus nec eros nisi. Proin luctus augue et porttitor pellentesque. Vivamus tempor sollicitudin ante molestie placerat.</p>

            <h1 id="etc">ETC</h1><hr>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. In elit diam, sollicitudin quis bibendum eu, consectetur quis neque. Donec faucibus nisi in nulla pharetra, dignissim fermentum justo maximus. Phasellus viverra, elit sed fermentum viverra, dui massa sodales quam, ac dignissim lorem ligula eget nulla. Aliquam at leo tellus. Aliquam sed dui at felis congue feugiat euismod sed nunc. Sed sit amet est ut risus bibendum dignissim. Fusce nibh lorem, lobortis ut lacus quis, sollicitudin placerat lacus. Nullam aliquam purus mauris, non finibus risus pretium tempor. Sed ipsum turpis, auctor at lacinia eu, lacinia et dui. Sed laoreet convallis condimentum. Donec vulputate ante in sagittis pharetra. Quisque id elit nibh. Ut ultrices et ex vel laoreet. Etiam eu bibendum ex. Suspendisse dictum pellentesque malesuada. Maecenas quis fermentum urna. Nam tincidunt nulla sit amet odio ultricies finibus consectetur sit amet velit. Phasellus accumsan eget magna sit amet suscipit. Etiam ac luctus justo. Vivamus ut sapien a velit tristique tempor nec quis turpis. Pellentesque porttitor, mauris a sagittis rutrum, ligula nunc euismod ex, ut imperdiet nulla erat ac neque. Pellentesque non risus quam. Vestibulum porta facilisis libero, ultricies pretium leo suscipit in. Nulla ac arcu metus. Cras metus nibh, dignissim vitae turpis eget, ornare feugiat magna. Pellentesque eu dui ut purus feugiat semper. Etiam vulputate mi non ante semper interdum. Sed eu mi ultrices ipsum molestie bibendum eu et nisi. Sed vitae nibh in ipsum tempor lacinia. Nam sit amet urna at dolor tristique bibendum. Nulla facilisi. Nullam diam sem, viverra vel ipsum et, iaculis dapibus arcu. Sed ut sapien in nunc aliquet maximus. Ut vitae turpis turpis. Mauris pellentesque egestas odio id consequat. Proin et nunc condimentum, faucibus est eu, interdum velit. Suspendisse sit amet gravida est. Phasellus vel augue non purus convallis facilisis. Morbi consequat enim risus, sit amet consequat ante suscipit eget. Vestibulum sed auctor sapien. Sed posuere venenatis felis ac porttitor. Nullam dictum ultrices purus sit amet tempus. In ac pretium lorem. Fusce vestibulum diam ac viverra hendrerit. Morbi facilisis mauris non mollis dignissim. Pellentesque ut odio fringilla, sagittis eros ac, aliquet arcu. Phasellus volutpat nisi id lectus porttitor, in tristique nulla fringilla. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Phasellus fringilla metus ac lorem ultricies eleifend at non urna. Vivamus ac porttitor nunc. Suspendisse pulvinar, arcu vitae vulputate dapibus, purus justo luctus metus, quis ultrices eros ligula viverra elit. Quisque id ornare nulla, non sollicitudin sem. Donec sem arcu, posuere eu efficitur eu, hendrerit nec urna. Morbi euismod molestie felis vel iaculis. Suspendisse feugiat urna consectetur, tristique lacus in, mattis erat. Pellentesque elit velit, consequat quis tincidunt ac, finibus in ante. Suspendisse blandit nisl mi, at tincidunt mi laoreet ac. Cras sit amet accumsan est. Curabitur sit amet ornare sem, fringilla pellentesque urna. Morbi ac bibendum quam. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque fermentum nec enim sit amet pharetra. Cras neque ante, laoreet nec venenatis non, mattis ac libero. Aliquam viverra vestibulum tempor. Aliquam porttitor diam eu volutpat rutrum. Nulla dictum nunc nec ullamcorper consectetur. Aliquam erat volutpat. Integer ac ultrices felis, in varius metus. In hac habitasse platea dictumst. Sed lacus tortor, luctus eu lobortis eu, sagittis non turpis. Mauris ac elit ut risus porta sagittis sed eget nisl. Pellentesque sodales est non congue euismod. In in odio lobortis, blandit lectus quis, venenatis ipsum. Cras sapien dolor, blandit ut posuere at, bibendum a ipsum. Sed quis massa in ex luctus lacinia. Vivamus nec eros nisi. Proin luctus augue et porttitor pellentesque. Vivamus tempor sollicitudin ante molestie placerat.</p>
        </article>
    
        <!-- Footer -->
        <footer>MMXIX @ ZIK, All my right are belongs to me</footer>
    </div>
</body>
</html>